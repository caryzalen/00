<!DOCTYPE html>
<html>
<head>
    <title>Web AR 虛擬戒指</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ar.js@2.3.1/aframe/build/aframe-ar.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/handtrackjs@0.0.23/dist/handtrack.min.js"></script>
</head>
<body>
    <a-scene embedded arjs>
        <a-box position="0 0.5 0" material="opacity: 0.5;"></a-box>
        <a-entity id="virtual-ring" gltf-model="assets/scene.gltf" scale="0.1 0.1 0.1"></a-entity>
    </a-scene>

    <script>
        const model = document.getElementById('virtual-ring');
        
        // 初始化Handtrack.js模型
        const modelParams = {
            flipHorizontal: true, // 改變鏡像模式
            maxNumBoxes: 1, // 追蹤一個手
            iouThreshold: 0.5,
            scoreThreshold: 0.6,
        };
        
        handTrack.load(modelParams).then(model => {
            // 啟動攝像頭
            handTrack.startVideo(document.querySelector('video')).then(status => {
                if (status) {
                    navigator.getUserMedia({ video: {} }, stream => {
                        document.querySelector('video').srcObject = stream;
                        // 進行手部追蹤
                        setInterval(() => {
                            model.detect(document.querySelector('video')).then(predictions => {
                                if (predictions.length > 0) {
                                    // 獲取手指位置
                                    const hand = predictions[0].bbox;
                                    const x = hand[0] + hand[2] / 2;
                                    const y = hand[1] + hand[3] / 2;
                                    
                                    // 將戒指模型移動到手指位置
                                    model.setAttribute('position', { x: x / window.innerWidth, y: -y / window.innerHeight, z: -1 });
                                }
                            });
                        }, 100);
                    }, err => console.log(err));
                }
            });
        });
    </script>
</body>
</html>
